<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carlos & Doris | Nuestra Boda</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Great+Vibes&family=Montserrat:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Configuración visual -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        terracotta: { light: '#e8b4a3', DEFAULT: '#c15b43', dark: '#9a432e' },
                        sand: '#fdfbf7',
                        charcoal: '#333333',
                    },
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        script: ['Great Vibes', 'cursive'],
                        sans: ['Montserrat', 'sans-serif'],
                        heading: ['Cinzel', 'serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #fdfbf7; overflow-x: hidden; }
        
        #welcome-overlay { position: fixed; inset: 0; background-color: #fdfbf7; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.8s; }
        #welcome-overlay.hidden-overlay { opacity: 0; visibility: hidden; pointer-events: none; }
        
        .fade-in-section { opacity: 0; transform: translateY(20px); transition: 1s; }
        .fade-in-section.is-visible { opacity: 1; transform: none; }
        
        @keyframes pulse-ring { 0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(193, 91, 67, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(193, 91, 67, 0); } 100% { transform: scale(0.8); } }
        .music-playing { animation: pulse-ring 2s infinite; }

        .nav-link.active { color: #c15b43 !important; font-weight: 700; }
        .nav-link { transition: color 0.3s ease; }
        #successModal { transition: opacity 0.3s ease; }
    </style>
</head>
<body class="text-charcoal font-sans antialiased">

    <!-- Audio -->
    <audio id="weddingMusic" loop preload="auto"><source src="cancion.mp3" type="audio/mpeg"></audio>

    <!-- Bienvenida -->
    <div id="welcome-overlay">
        <div class="text-center p-8 animate-pulse">
            <p id="welcome-guest-name" class="font-heading text-terracotta text-lg mb-2 hidden"></p>
            <div class="font-script text-6xl md:text-8xl text-terracotta mb-4">C & D</div>
            <p class="font-heading uppercase tracking-widest text-gray-500 mb-8">Nuestra Boda</p>
            <button onclick="enterSite()" class="bg-terracotta text-white font-heading uppercase tracking-widest py-4 px-10 rounded shadow-xl hover:scale-105 transition-transform">Abrir Invitación</button>
        </div>
    </div>

    <!-- Navegación -->
    <nav class="fixed top-0 w-full z-50 bg-sand/90 backdrop-blur-md shadow-sm transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="font-script text-3xl text-terracotta">C & D</div>
                <div class="hidden md:flex space-x-8 text-sm uppercase tracking-widest font-heading">
                    <a href="#home" class="nav-link text-gray-600 hover:text-terracotta">Inicio</a>
                    <a href="#details" class="nav-link text-gray-600 hover:text-terracotta">Detalles</a>
                    <a href="#itinerary" class="nav-link text-gray-600 hover:text-terracotta">Itinerario</a>
                    <a href="#rsvp" class="nav-link text-gray-600 hover:text-terracotta">Confirmar</a>
                </div>
                <div class="md:hidden"><button onclick="toggleMobileMenu()" class="text-terracotta"><i class="fas fa-bars text-2xl"></i></button></div>
            </div>
        </div>
        <div id="mobileMenu" class="hidden md:hidden bg-white border-t border-gray-100 p-4 text-center font-heading text-sm uppercase space-y-4 shadow-lg">
            <a href="#home" onclick="toggleMobileMenu()" class="nav-link block text-gray-600 hover:text-terracotta">Inicio</a>
            <a href="#details" onclick="toggleMobileMenu()" class="nav-link block text-gray-600 hover:text-terracotta">Detalles</a>
            <a href="#itinerary" onclick="toggleMobileMenu()" class="nav-link block text-gray-600 hover:text-terracotta">Itinerario</a>
            <a href="#rsvp" onclick="toggleMobileMenu()" class="nav-link block text-gray-600 hover:text-terracotta">Confirmar</a>
        </div>
    </nav>

    <!-- Música Flotante -->
    <button id="musicToggle" onclick="toggleMusic()" class="hidden fixed bottom-4 right-4 z-50 w-12 h-12 bg-white text-terracotta rounded-full shadow-lg flex items-center justify-center border border-terracotta/20"><i class="fas fa-play ml-1" id="musicIcon"></i></button>
    
    <!-- Hero (Section ID: home) -->
    <section id="home" class="relative h-screen flex items-center justify-center text-center px-4 overflow-hidden">
        <div class="absolute inset-0 z-0"><img src="https://images.unsplash.com/photo-1519741497674-611481863552?q=80&w=2070&auto=format&fit=crop" class="w-full h-full object-cover brightness-[0.65]"></div>
        <div class="relative z-10 text-white fade-in-section">
            <p class="text-sm uppercase tracking-[0.3em] mb-4">¡Nos casamos!</p>
            <h1 class="font-script text-7xl md:text-9xl text-terracotta-light">Carlos & Doris</h1>
            <p class="font-heading text-xl tracking-widest my-6">05 . 06 . 2026</p>
            <a href="#rsvp" class="inline-block bg-terracotta text-white font-heading text-xs uppercase tracking-widest py-4 px-10 rounded shadow-lg hover:bg-white hover:text-terracotta transition-all">Acompañanos</a>
        </div>
    </section>

    <!-- Frase -->
    <section class="py-20 px-4 bg-sand text-center">
        <div class="max-w-2xl mx-auto fade-in-section">
            <i class="fas fa-heart text-terracotta text-2xl mb-6"></i>
            <h2 class="font-serif text-3xl italic text-charcoal mb-4">"El amor no consiste en mirarse el uno al otro, sino en mirar juntos en la misma dirección."</h2>
        </div>
    </section>

    <!-- Detalles (Section ID: details) -->
    <section id="details" class="py-24 px-4 bg-white scroll-mt-20">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-16 fade-in-section">
                <span class="text-terracotta uppercase tracking-[0.2em] text-xs font-bold">Ubicación</span>
                <h2 class="font-serif text-4xl md:text-5xl text-charcoal mt-2 mb-4">Cuándo & Dónde</h2>
                <div class="w-20 h-1 bg-terracotta mx-auto"></div>
            </div>
            <div class="grid md:grid-cols-2 gap-12 text-center">
                <div class="fade-in-section bg-sand p-10 rounded-xl shadow-sm border border-terracotta/10">
                    <i class="fas fa-church text-4xl text-terracotta mb-4"></i>
                    <h3 class="font-heading text-xl mb-2">Ceremonia</h3>
                    <p class="font-serif text-2xl text-terracotta mb-4">1:00 PM</p>
                    <p class="text-gray-600 mb-6">Parroquia de Santa Maria<br>Calle Principal #123</p>
                    <button onclick="window.open('https://maps.app.goo.gl/EVPgQESHV9RtaKwz8','_blank')" class="text-xs font-bold uppercase text-terracotta border-b border-terracotta">Ver Mapa</button>
                </div>
                <div class="fade-in-section bg-sand p-10 rounded-xl shadow-sm border border-terracotta/10">
                    <i class="fas fa-glass-cheers text-4xl text-terracotta mb-4"></i>
                    <h3 class="font-heading text-xl mb-2">Recepción</h3>
                    <p class="font-serif text-2xl text-terracotta mb-4">3:00 PM</p>
                    <p class="text-gray-600 mb-6">Salon los Pinos<br>Carretera Federal km 45</p>
                    <button onclick="window.open('https://maps.app.goo.gl/d3AY6gjdNXA9y5Xs9','_blank')" class="text-xs font-bold uppercase text-terracotta border-b border-terracotta">Ver Mapa</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Itinerario (Section ID: itinerary) -->
    <section id="itinerary" class="py-20 px-4 bg-sand relative overflow-hidden scroll-mt-20">
        <i class="fas fa-leaf absolute -left-10 top-20 text-[200px] text-terracotta/5 rotate-45"></i>
        <div class="max-w-3xl mx-auto relative z-10">
            <div class="text-center mb-16 fade-in-section">
                <span class="text-terracotta uppercase tracking-[0.2em] text-xs font-bold">Timeline</span>
                <h2 class="font-serif text-4xl text-charcoal mt-2">El Gran Día</h2>
            </div>
            <div class="relative border-l-2 border-terracotta/30 ml-4 md:ml-1/2 space-y-12">
                <div class="relative pl-8 md:ml-6 fade-in-section">
                    <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-terracotta border-2 border-sand"></div>
                    <div class="md:flex md:justify-between md:items-center w-full">
                        <span class="font-serif text-2xl text-terracotta block md:w-1/3 md:text-right md:pr-10">1:00 PM</span>
                        <div class="md:w-2/3"><h4 class="font-heading text-lg font-bold text-gray-800">Ceremonia</h4><p class="text-gray-500 text-sm">Sí, acepto.</p></div>
                    </div>
                </div>
                <div class="relative pl-8 md:ml-6 fade-in-section">
                    <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-terracotta border-2 border-sand"></div>
                    <div class="md:flex md:justify-between md:items-center w-full">
                        <span class="font-serif text-2xl text-terracotta block md:w-1/3 md:text-right md:pr-10">3:00 PM</span>
                        <div class="md:w-2/3"><h4 class="font-heading text-lg font-bold text-gray-800">Cóctel</h4><p class="text-gray-500 text-sm">Música y bebidas.</p></div>
                    </div>
                </div>
                <div class="relative pl-8 md:ml-6 fade-in-section">
                    <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-terracotta border-2 border-sand"></div>
                    <div class="md:flex md:justify-between md:items-center w-full">
                        <span class="font-serif text-2xl text-terracotta block md:w-1/3 md:text-right md:pr-10">7:30 PM</span>
                        <div class="md:w-2/3"><h4 class="font-heading text-lg font-bold text-gray-800">Cena</h4><p class="text-gray-500 text-sm">Banquete.</p></div>
                    </div>
                </div>
                <div class="relative pl-8 md:ml-6 fade-in-section">
                    <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-terracotta border-2 border-sand"></div>
                    <div class="md:flex md:justify-between md:items-center w-full">
                        <span class="font-serif text-2xl text-terracotta block md:w-1/3 md:text-right md:pr-10">9:00 PM</span>
                        <div class="md:w-2/3"><h4 class="font-heading text-lg font-bold text-gray-800">Fiesta</h4><p class="text-gray-500 text-sm">A bailar.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- RSVP Real (Section ID: rsvp) -->
    <section id="rsvp" class="py-24 px-4 bg-terracotta-light/20 scroll-mt-20">
        <div class="max-w-3xl mx-auto bg-white p-8 md:p-12 rounded-2xl shadow-xl fade-in-section min-h-[500px] flex items-center justify-center">
            
            <div class="w-full">
                <div class="text-center mb-10">
                    <span class="text-terracotta uppercase tracking-[0.2em] text-xs font-bold">RSVP</span>
                    <!-- TITULO (Se oculta al confirmar) -->
                    <h2 id="rsvp-title" class="font-serif text-4xl text-charcoal mt-2">Confirma tu Asistencia</h2>
                    <!-- MENSAJE DE LÍMITE (Se oculta al confirmar) -->
                    <p id="rsvp-limit-message" class="text-terracotta text-sm font-bold mt-2 hidden"></p>
                </div>

                <!-- MENSAJE DE ÉXITO FINAL (Se muestra al confirmar) -->
                <div id="rsvp-success-message" class="hidden text-center py-10">
                    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-500 animate-bounce">
                        <i class="fas fa-check text-3xl"></i>
                    </div>
                    <!-- TEXTO DINÁMICO DE LUGARES -->
                    <p id="final-confirmation-text" class="text-terracotta font-serif text-2xl mb-2 font-bold"></p>
                    <p class="text-gray-600 mb-6">Hemos registrado tu respuesta correctamente.</p>
                    <p class="text-sm text-gray-400 uppercase tracking-widest">Nos vemos en la boda</p>
                </div>

                <!-- FORMULARIO -->
                <form id="rsvpForm" class="space-y-6" name="submit-to-google-sheet">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs uppercase tracking-wider text-gray-500 mb-2">Nombre</label>
                            <input type="text" id="rsvp-name" name="nombre" required class="w-full bg-sand p-4 rounded outline-none border border-transparent focus:border-terracotta" placeholder="Tu nombre">
                        </div>
                        <div>
                            <label class="block text-xs uppercase tracking-wider text-gray-500 mb-2">Teléfono (10 dígitos)</label>
                            <input type="tel" name="telefono" id="rsvp-phone" required class="w-full bg-sand p-4 rounded outline-none border border-transparent focus:border-terracotta" placeholder="55 1234 5678" maxlength="10">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-wider text-gray-500 mb-2">¿Asistirás?</label>
                        <div class="flex space-x-6 mt-2">
                            <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="asistencia" value="Si" class="text-terracotta focus:ring-terracotta" checked><span>¡Sí, ahí estaré!</span></label>
                            <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="asistencia" value="No" class="text-terracotta focus:ring-terracotta"><span>Lo siento, no podré ir</span></label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-wider text-gray-500 mb-2">Personas</label>
                        <select id="rsvp-guests" name="invitados" class="w-full bg-sand p-4 rounded outline-none"><option value="1">1 Persona</option></select>
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-wider text-gray-500 mb-2">Mensaje</label>
                        <textarea name="mensaje" rows="2" class="w-full bg-sand p-4 rounded outline-none" placeholder="Mensaje..."></textarea>
                    </div>
                    <button type="submit" class="w-full bg-terracotta text-white font-heading uppercase tracking-widest py-4 rounded hover:bg-terracotta-dark transition-colors">Enviar Confirmación</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-charcoal text-white py-12 text-center">
        <h2 class="font-script text-5xl mb-6 text-terracotta-light">C & D</h2>
        <div class="text-xs text-gray-600">&copy; 2026 Carlos & Doris.</div>
    </footer>

    <!-- MODAL DE ÉXITO (Oculto) -->
    <div id="successModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 hidden opacity-0 pointer-events-none">
        <div class="bg-white p-8 rounded-xl max-w-sm text-center m-4 shadow-2xl transform scale-95 transition-transform duration-300" id="modalContent">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-green-500"><i class="fas fa-check text-2xl"></i></div>
            <h3 class="font-serif text-2xl text-terracotta mb-2">¡Gracias!</h3>
            <p class="text-gray-500 mb-6">Hemos recibido tu confirmación correctamente.</p>
            <button onclick="closeModal()" class="bg-terracotta text-white px-6 py-2 rounded hover:bg-terracotta-dark transition-colors">Cerrar</button>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // -------------------------------------------------------------
        // URL DE TU SCRIPT DE GOOGLE
        // -------------------------------------------------------------
        const scriptURL = "https://script.google.com/macros/s/AKfycbxlk8DVe-RpZhkYEoAFNU2XqVxY_j-IHUaHFS9OrlRFshYwlLe9Q1bb77Pc7yF9EcG8/exec";
        // -------------------------------------------------------------

        // 1. Música
        const audio = document.getElementById('weddingMusic');
        const musicBtn = document.getElementById('musicToggle');
        const musicIcon = document.getElementById('musicIcon');

        function enterSite() {
            document.getElementById('welcome-overlay').classList.add('hidden-overlay');
            musicBtn.classList.remove('hidden');
            
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    musicIcon.className = "fas fa-pause";
                    musicBtn.classList.add('music-playing');
                }).catch(error => {
                    console.log("Autoplay bloqueado");
                });
            }
        }

        function toggleMusic() {
            if (audio.paused) {
                audio.play();
                musicIcon.className = "fas fa-pause";
                musicBtn.classList.add('music-playing');
            } else {
                audio.pause();
                musicIcon.className = "fas fa-play ml-1";
                musicBtn.classList.remove('music-playing');
            }
        }

        // 2. Navegación Activa (Scroll Spy) y Menú Móvil
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('.nav-link');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= (sectionTop - 300)) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (current && link.getAttribute('href').includes(current)) {
                    link.classList.add('active');
                }
            });
            
            const nav = document.getElementById('navbar');
            if (window.scrollY > 50) { nav.classList.add('shadow-md', 'bg-white/95'); nav.classList.remove('bg-sand/90'); }
            else { nav.classList.remove('shadow-md', 'bg-white/95'); nav.classList.add('bg-sand/90'); }
        });

        // 3. Formulario, Validación, Modal y Seguridad LocalStorage
        const form = document.forms['submit-to-google-sheet'];
        const successMessage = document.getElementById('rsvp-success-message');
        const limitMessage = document.getElementById('rsvp-limit-message');
        const rsvpTitle = document.getElementById('rsvp-title'); 
        const finalText = document.getElementById('final-confirmation-text');

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const nombre = urlParams.get('nombre');
            const pases = urlParams.get('pases');
            
            // 1. GENERAR LLAVE ÚNICA DE LOCALSTORAGE (vinculada al nombre)
            // Si no hay nombre, usa 'generic'
            const storageKey = 'rsvp_conf_' + (nombre ? encodeURIComponent(nombre) : 'generic');

            // 2. VERIFICAR SI ESTE INVITADO YA CONFIRMÓ
            const storedData = localStorage.getItem(storageKey);

            if (storedData) {
                // --- YA CONFIRMÓ ---
                const data = JSON.parse(storedData);
                
                // Ocultar form y títulos
                form.classList.add('hidden');
                rsvpTitle.classList.add('hidden');
                limitMessage.classList.add('hidden'); // Asegurar que no salga
                
                // Mostrar mensaje éxito
                finalText.innerText = "Ya has confirmado " + data.count + (data.count == 1 ? " lugar" : " lugares");
                successMessage.classList.remove('hidden');

                // Saludo personalizado (opcional)
                if (nombre) {
                    document.getElementById('welcome-guest-name').innerText = "¡Hola de nuevo, " + nombre + "!";
                    document.getElementById('welcome-guest-name').classList.remove('hidden');
                }

            } else {
                // --- NO HA CONFIRMADO (Mostrar Formulario) ---
                
                if (nombre) {
                    document.getElementById('welcome-guest-name').innerText = "¡Hola, " + nombre + "!";
                    document.getElementById('welcome-guest-name').classList.remove('hidden');
                    document.getElementById('rsvp-name').value = nombre;
                }

                if (pases) {
                    const select = document.getElementById('rsvp-guests');
                    const max = parseInt(pases);
                    select.innerHTML = '';
                    for (let i = 1; i <= max; i++) {
                        let opt = document.createElement("option");
                        opt.value = i;
                        opt.text = i + (i === 1 ? " Persona" : " Personas");
                        select.appendChild(opt);
                    }
                    select.value = max;
                    
                    // Solo mostramos el límite si el formulario está visible
                    limitMessage.innerText = `Tienes ${max} lugares reservados.`;
                    limitMessage.classList.remove('hidden');
                }
            }

            // Manejo del Envío
            form.addEventListener('submit', e => {
                e.preventDefault();

                const phoneInput = form.querySelector('input[name="telefono"]');
                const phoneVal = phoneInput.value.replace(/\D/g, ''); 
                
                if (phoneVal.length !== 10) {
                    alert("Por favor, ingresa un número de teléfono válido de 10 dígitos.");
                    phoneInput.focus();
                    return;
                }

                const guestsConfirmed = form.querySelector('select[name="invitados"]').value;
                const btn = form.querySelector('button[type="submit"]');
                const originalText = btn.innerText;
                btn.innerText = "Enviando...";
                btn.disabled = true;

                fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                    .then(response => {
                        // 1. GUARDAR EN LOCALSTORAGE CON LA LLAVE ESPECÍFICA
                        const dataToSave = { confirmed: true, count: guestsConfirmed };
                        localStorage.setItem(storageKey, JSON.stringify(dataToSave));

                        // 2. MOSTRAR MODAL
                        const modal = document.getElementById('successModal');
                        const modalContent = document.getElementById('modalContent');
                        modal.classList.remove('hidden');
                        
                        setTimeout(() => {
                            modal.classList.remove('opacity-0', 'pointer-events-none');
                            modalContent.classList.remove('scale-95');
                            modalContent.classList.add('scale-100');
                        }, 10);

                        // 3. UI UPDATES
                        finalText.innerText = "Has confirmado " + guestsConfirmed + (guestsConfirmed == 1 ? " lugar" : " lugares");
                        
                        form.classList.add('hidden');
                        limitMessage.classList.add('hidden'); 
                        rsvpTitle.classList.add('hidden');
                        successMessage.classList.remove('hidden');

                        form.reset();
                        btn.innerText = originalText;
                        btn.disabled = false;
                    })
                    .catch(error => {
                        alert("Hubo un error al enviar. Por favor intenta de nuevo.");
                        btn.innerText = originalText;
                        btn.disabled = false;
                    });
            });
        };

        function closeModal() {
            const modal = document.getElementById('successModal');
            const modalContent = document.getElementById('modalContent');
            modal.classList.add('opacity-0', 'pointer-events-none');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }

        function toggleMobileMenu() { document.getElementById('mobileMenu').classList.toggle('hidden'); }
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('is-visible'); observer.unobserve(entry.target); } });
        }, { threshold: 0.15 });
        document.querySelectorAll('.fade-in-section').forEach(s => observer.observe(s));
    </script>
</body>
</html>


